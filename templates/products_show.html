{% extends './basic/base.html' %}

{% block content %}
<h1 class="text-center my-4">Product Details</h1>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">

            <div class="card shadow">
                <div class="row g-0">

                    <!-- Product Image -->
                    <div class="col-md-5 text-center p-3 position-relative">
                        {% if products.product_image %}
                            <img src="{{ products.product_image.url }}"
                                 class="img-fluid rounded"
                                 alt="{{ products.name }}">
                        {% else %}
                            <div class="text-muted">No Image</div>
                        {% endif %}

                        {% if products.qantity|default:0|add:0 <= 0 %}
                            <span class="badge bg-danger position-absolute top-0 start-0 m-3">
                                Out of Stock
                            </span>
                        {% endif %}
                    </div>

                    <!-- Product Details -->
                    <div class="col-md-7">
                        <div class="card-body">

                            <h3 class="card-title">{{ products.name }}</h3>
                            <p class="text-muted">Vendor: {{ products.vendor }}</p>

                            <!-- Price -->
                            <p class="fs-5">
                                {% if products.original_price and products.original_price > products.selling_price %}
                                    <del class="text-danger">₹{{ products.original_price }}</del>
                                {% endif %}
                                <span class="fw-bold text-success ms-2">₹{{ products.selling_price }}</span>
                            </p>

                            <p>{{ products.description }}</p>

                            <!-- Stock / Add to Cart Button -->
                            <div class="input-group my-3 bg-success" style="width:130px;">
                            <button class="btn btn-outline-secondary text-white" type="button" id="btn-decrease">-</button>
                            <input type="number" class="form-control text-center" value="1" min="1" max="{{ products.quantity }}" id="product-quantity">
                            <button class="btn btn-outline-secondary text-white" type="button" id="btn-increase">+</button>
                            </div>

                            {% if products.qantity > 0 %}
                            <input type="hidden" value="{{products.id}}" id="pid">
                           

                                <button class="btn btn-success mb-2" id="btncard">
                                    <i class="fa fa-shopping-cart"></i> Add to Cart
                                </button>
                            {% else %}  
                                <button class="btn btn-danger mb-2" disabled>
                                    <i class="fa fa-times-circle"></i> Out of Stock
                                </button>
                            {% endif %}

                            <!-- Wishlist Button -->
                            <button class="btn btn-outline-danger ms-2 mb-2" id="btnFav">
                                <i class="fa fa-heart"></i> Wishlist
                            </button>
                            

                        </div>
                    </div>

                </div>
            </div>

            <!-- Back Button -->
            <button class="btn btn-link mt-3">
                ⬅ Back to Products
            </button>

        </div>
    </div>
</div>

 
<script>
document.addEventListener("DOMContentLoaded", function(event) {
  const btnPlus = document.getElementById("btn-increase");
  const btnMinus = document.getElementById("btn-decrease");
  const txtQty = document.getElementById("product-quantity");
  const pid = document.getElementById("pid");
  const btnCart = document.getElementById("btncard");
  const btnFav = document.getElementById("btnFav");

  btnPlus.addEventListener("click", function() {
    let qty=parseInt(txtQty.value,10);
    qty=isNaN(qty)?0:qty;
    //console.log(qty);
    if(qty<10){
      qty++;
      txtQty.value=qty;
    }
  });

  btnMinus.addEventListener("click", function() {
      let qty=parseInt(txtQty.value,10);
      qty=isNaN(qty)?0:qty;
      //console.log(qty);
      if(qty>1){
        qty--;
        txtQty.value=qty;
      }
  });

  btnCart.addEventListener("click", function() {
      let qty=parseInt(txtQty.value,10);
      qty=isNaN(qty)?0:qty;
      
      if(qty>0){
        let postObj = { 
            'product_qty': qty, 
            'pid': pid.value
        }
        console.log(postObj);
        fetch("/addtocart",{
          method: 'POST',
          credentials: 'same-origin',
          headers:{
              'Accept': 'application/json',
              'X-Requested-With': 'XMLHttpRequest',
              'X-CSRFToken': '{{ csrf_token }}',
          },
          body: JSON.stringify(postObj)
        }).then(response => {
	        return response.json();
        }).then(data => {
        	//console.log(data);
          alert(data['status']);
        });
 

      }else{
        alert("Please Enter The Quantity");
      }
      
  });


  btnFav.addEventListener("click", function() {
     
        let postObj = { 
            'pid': pid.value
        }
        console.log(postObj);
        fetch("/fav",{
          method: 'POST',
          credentials: 'same-origin',
          headers:{
              'Accept': 'application/json',
              'X-Requested-With': 'XMLHttpRequest',
              'X-CSRFToken': '{{ csrf_token }}',
          },
          body: JSON.stringify(postObj)
        }).then(response => {
	        return response.json();
        }).then(data => {
        	//console.log(data);
          alert(data['status']);
        });
      
  });


});
 </script>
 
{% endblock %}